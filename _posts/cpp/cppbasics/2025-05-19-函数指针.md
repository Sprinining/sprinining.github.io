---
title: å‡½æ•°æŒ‡é’ˆ
date: 2025-05-19 07:41:48 +0800
categories: [cpp, cpp basics]
tags: [CPP]
description: 
---
## å‡½æ•°æŒ‡é’ˆ

å‡½æ•°æŒ‡é’ˆæ˜¯ C++ ä¸­ä¸€ç§**ä¿å­˜å‡½æ•°åœ°å€**çš„æŒ‡é’ˆå˜é‡ï¼Œå…è®¸åƒè°ƒç”¨æ™®é€šå‡½æ•°é‚£æ ·é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•°ã€‚å®ƒæ˜¯ç†è§£å›è°ƒæœºåˆ¶ã€ç­–ç•¥æ¨¡å¼ã€ä»¥åŠ C/C++ ä¸­å‡½æ•°çµæ´»æ€§çš„åŸºç¡€ã€‚

### åŸºæœ¬å®šä¹‰æ ¼å¼

```cpp
è¿”å›ç±»å‹ (*å‡½æ•°æŒ‡é’ˆå)(å‚æ•°ç±»å‹åˆ—è¡¨);
```

ç¤ºä¾‹ï¼š

```cpp
int add(int a, int b) {
    return a + b;
}

// å®šä¹‰å‡½æ•°æŒ‡é’ˆ
int (*funcPtr)(int, int);

// æŠŠå‡½æ•°åœ°å€èµ‹ç»™æŒ‡é’ˆ
funcPtr = add;

// é€šè¿‡æŒ‡é’ˆè°ƒç”¨å‡½æ•°
int result = funcPtr(3, 4);  // ç»“æœæ˜¯ 7
```

### ç»å…¸ç”¨é€”

 å›è°ƒå‡½æ•°ï¼ˆå¦‚æ’åºæ¯”è¾ƒå™¨ï¼‰ï¼š

```cpp
bool cmp(int a, int b) {
    return a > b;
}

void sort(int* arr, int n, bool (*cmpFunc)(int, int)) {
    for (int i = 0; i < n - 1; ++i)
        for (int j = i + 1; j < n; ++j)
            if (!cmpFunc(arr[i], arr[j]))
                std::swap(arr[i], arr[j]);
}
```

è°ƒç”¨ï¼š

```cpp
int arr[] = {3, 1, 5, 2};
sort(arr, 4, cmp);  // ä½¿ç”¨ cmp ä½œä¸ºæ¯”è¾ƒå™¨
```

### ç®€åŒ–è¯­æ³•ï¼ˆä½¿ç”¨ `typedef` æˆ– `using`ï¼‰

- ä½¿ç”¨ typedefï¼š

```cpp
typedef int (*CalcFunc)(int, int);
CalcFunc f = add;
```

- ä½¿ç”¨ usingï¼ˆæ¨èï¼‰ï¼š

```cpp
using CalcFunc = int(*)(int, int);
CalcFunc f = add;
```

### å‡½æ•°æŒ‡é’ˆæ•°ç»„ï¼ˆç­–ç•¥è¡¨ï¼‰

```cpp
int add(int a, int b) { return a + b; }
int sub(int a, int b) { return a - b; }

using CalcFunc = int(*)(int, int);
CalcFunc ops[] = {add, sub};

int result = ops[0](10, 5);  // è°ƒç”¨ addï¼Œç»“æœæ˜¯ 15
```

### å¯¹æ¯” lambdaã€std::functionã€è™šå‡½æ•°æŒ‡é’ˆ

| ç‰¹æ€§/ç»´åº¦            | å‡½æ•°æŒ‡é’ˆ               | Lambda           | `std::function`        | è™šå‡½æ•°æŒ‡é’ˆï¼ˆå¤šæ€ï¼‰   |
| -------------------- | ---------------------- | ---------------- | ---------------------- | -------------------- |
| ğŸ§  ç±»å‹å®‰å…¨           | âœ… æœ‰                   | âœ… æœ‰             | âœ… æœ‰                   | âœ… æœ‰                 |
| ğŸ“¦ å¯æ•è·å˜é‡ï¼ˆé—­åŒ…ï¼‰ | âŒ ä¸æ”¯æŒ               | âœ… æ”¯æŒï¼ˆæ•è·ï¼‰   | âœ… æ”¯æŒæ•è·             | âŒ ä¸æ”¯æŒ             |
| ğŸ” è¿è¡Œæ—¶å¯æ›¿æ¢æ€§     | âœ…                      | âœ…/âš ï¸ï¼ˆæ— æ•è·ï¼‰    | âœ… æ”¯æŒ                 | âœ… æ”¯æŒ               |
| ğŸ§® è°ƒç”¨å¼€é”€ï¼ˆæ€§èƒ½ï¼‰   | ğŸš€ æå¿«ï¼ˆç­‰åŒå‡½æ•°è°ƒç”¨ï¼‰ | ğŸš€ æå¿«ï¼ˆæ— æ•è·ï¼‰ | ğŸ¢ æ…¢äº›ï¼ˆå°è£…ã€å †åˆ†é…ï¼‰ | ğŸš€ å¿«ï¼ˆè™šè¡¨æŒ‡é’ˆè·³è½¬ï¼‰ |
| ğŸ› ï¸ å­˜å‚¨/è¯­æ³•å¤æ‚åº¦    | ä¸­ï¼ˆå‡½æ•°ç­¾åç¹çï¼‰     | ç®€æ´             | ç®€æ´                   | ä¸­ï¼ˆéœ€è¦ç±»å®šä¹‰ï¼‰     |
| ğŸ§© å¯ç”¨äºç±»æˆå‘˜       | âš ï¸ ä¸èƒ½ç›´æ¥             | âœ… å¯             | âœ… å¯                   | âœ… è™šå‡½æ•°             |
| â™»ï¸ å¯ç”¨äºç­–ç•¥/å›è°ƒ    | âœ… æ˜¯                   | âœ… æ˜¯             | âœ… æ˜¯                   | âœ… æ˜¯                 |
| ğŸ§± æ˜¯å¦ç¼–è¯‘æœŸå¯æ±‚å€¼   | âŒ å¦                   | âš ï¸ æ— æ•è·å¯ä»¥     | âŒ å¦                   | âŒ å¦                 |

#### å‡½æ•°æŒ‡é’ˆï¼ˆæœ€å¤è€ä¹Ÿæœ€å¿«ï¼‰

```cpp
int add(int a, int b) { return a + b; }
int (*fptr)(int, int) = add;
fptr(3, 4); // ç»“æœ 7
```

- ä¼˜ç‚¹ï¼šå¼€é”€ä½ã€è¯­ä¹‰æ¸…æ™°
- ç¼ºç‚¹ï¼šä¸èƒ½ç»‘å®šçŠ¶æ€ã€ä¸æ”¯æŒæ•è·ã€ä¸æ”¯æŒç±»æˆå‘˜å‡½æ•°

#### Lambda è¡¨è¾¾å¼

```cpp
auto f = [](int a, int b) { return a + b; };
f(3, 4); // ç»“æœ 7

int x = 10;
auto g = [x](int y) { return x + y; }; // æ•è·å¤–éƒ¨å˜é‡
```

- æœ‰çŠ¶æ€æ—¶æ˜¯ç±»å¯¹è±¡ï¼ˆç¼–è¯‘å™¨ç”Ÿæˆï¼‰ï¼Œ**ä¸èƒ½éšå¼è½¬å‡½æ•°æŒ‡é’ˆ**
- **æ— æ•è·æ—¶å¯ä»¥è‡ªåŠ¨è½¬æˆå‡½æ•°æŒ‡é’ˆ**

#### `std::function`ï¼ˆæ³›å‹å¯è°ƒç”¨å°è£…å™¨ï¼‰

```cpp
#include <functional>

std::function<int(int, int)> f = [](int a, int b) {
    return a + b;
};
f(3, 4); // ç»“æœ 7
```

- æ”¯æŒ lambdaï¼ˆæœ‰/æ— æ•è·ï¼‰ã€å‡½æ•°æŒ‡é’ˆã€æˆå‘˜å‡½æ•°ã€ä»¿å‡½æ•°
- å†…éƒ¨å°è£…å¤æ‚ç±»å‹ï¼Œ**æ˜“ç”¨ä½†å¯èƒ½æœ‰å †å†…å­˜å¼€é”€**
- æ¨èç”¨äºé«˜æŠ½è±¡ã€æ’ä»¶ç³»ç»Ÿã€é€šç”¨å›è°ƒæ¥å£

#### è™šå‡½æ•°æŒ‡é’ˆï¼ˆå¤šæ€ï¼‰

```cpp
class Strategy {
public:
    virtual int apply(int a, int b) = 0;
    virtual ~Strategy() = default;
};

class Add : public Strategy {
public:
    int apply(int a, int b) override { return a + b; }
};
```

- æ”¯æŒæ¥å£å¤šæ€ï¼ˆè¿è¡Œæ—¶ç»‘å®šï¼‰
- ç±»ä¸­é€šè¿‡è™šå‡½æ•°è¡¨è°ƒç”¨ï¼Œæ”¯æŒæˆå‘˜çŠ¶æ€
- æœ‰è½»å¾®å¼€é”€ï¼ˆè™šè¡¨æŒ‡é’ˆè·³è½¬ï¼‰ï¼Œä½†æ˜¯**é¢å‘å¯¹è±¡è®¾è®¡æ ¸å¿ƒ**

| åœºæ™¯                          | æ¨èæ–¹æ¡ˆ                   | ç†ç”±       |
| ----------------------------- | -------------------------- | ---------- |
| é«˜æ€§èƒ½ã€æ— çŠ¶æ€ç­–ç•¥ï¼ˆå¦‚ sortï¼‰ | âœ… å‡½æ•°æŒ‡é’ˆ / æ— æ•è· Lambda | å¿«ï¼Œç®€å•   |
| åŠ¨æ€ç­–ç•¥ï¼Œæœ‰æ•è·              | âœ… `std::function`          | æ”¯æŒé—­åŒ…   |
| é¢å‘å¯¹è±¡ç­–ç•¥ï¼Œå¤šæ€ç»“æ„        | âœ… è™šå‡½æ•°                   | æ‰©å±•æ€§å¼º   |
| ç¼–è¯‘æœŸç­–ç•¥                    | âœ… æ¨¡æ¿ / `constexpr` å‡½æ•°  | ç¼–è¯‘æ—¶è®¡ç®— |
| å°å·¥å…·å‡½æ•° / callback         | âœ… Lambda                   | ç®€æ´ã€ç°ä»£ |
