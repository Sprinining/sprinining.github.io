---
title: 不可变对象
date: 2024-07-11 11:33:14 +0800
categories: [java, java basics]
tags: [Java, Object]
description: 
---
# 不可变类

- 一个类的对象在通过构造方法创建后如果状态不会再被改变，那么它就是一个不可变（immutable）类。它的所有成员变量的赋值仅在构造方法中完成，不会提供任何 setter 方法供外部类去修改。

## 不可变类String

#### 1）常量池的需要

字符串常量池是 Java 堆内存中一个特殊的存储区域，当创建一个 String 对象时，假如此字符串在常量池中不存在，那么就创建一个；假如已经存，就不会再创建了，而是直接引用已经存在的对象。这样做能够减少 JVM 的内存开销，提高效率。

#### 2）hashCode 需要

因为字符串是不可变的，所以在它创建的时候，其 hashCode 就被缓存了，因此非常适合作为哈希值（比如说作为 HashMap的键），多次调用只返回同一个值，来提高效率。

#### 3）线程安全

就像之前说的那样，如果对象的状态是可变的，那么在多线程环境下，就很容易造成不可预期的结果。而 String 是不可变的，就可以在多个线程之间共享，不需要同步处理。

因此，当我们调用 String 类的任何方法（比如说 `trim()`、`substring()`、`toLowerCase()`）时，==总会返回一个新的对象==，而不影响之前的值。

## 自定义不可变类

1）确保类final的，不允许被其他类继承。

2）确保所有的成员变量（字段）是final的，这样的话，它们就只能在构造方法中初始化值，并且不会在随后被修改。

3）不要提供任何setter方法。

4）如果要修改类的状态，必须返回一个新的对象。
